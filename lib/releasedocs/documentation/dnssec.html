<h1>DNSSEC and DANE</h1><p><a href="index.html">Back</a></p><p><strong>DNSSEC and DANE support in Smack and MiniDNS is still in its infancy. It should be considered experimental and not ready for production use at this time.</strong> We would like to see more thorough testing and review by the security community. If you can help, then please do not hesitate to contact us.</p><h2>About</h2><p>DNSSEC (<a href="https://tools.ietf.org/html/rfc4033">RFC 4033</a> and others) authenticates DNS answers, positive and negative ones. This means that if a DNS response secured by DNSSEC turns out to be authentic, then you can be sure that the domain either exists, and that the returned resource records (RRs) are the ones the domain owner authorized, or that the domain does not exists and that nobody tried to fake its non existence.</p><p>The tricky part is that an application using DNSSEC can not determine whether a domain uses DNSSEC, does not use DNSSEC or if someone downgraded your DNS query using DNSSEC to a response without DNSSEC.</p><p><a href="https://tools.ietf.org/html/rfc6698">DANE</a> allows the verification of a TLS certificate with information stored in the DNS system and secured by DNSSEC. Thus DANE requires DNSSEC.</p><h2>Prerequisites</h2><p>From the three DNS resolver providers (MiniDNS, javax, dnsjava) supported by Smack only <a href="https://github.com/rtreffer/minidns">MiniDNS</a> currently supports DNSSEC. MiniDNS is the default resolver when smack-android is used. For other configurations, make sure to add smack-resolver-minidns to your dependencies and call <code>MiniDnsResolver.setup()</code> prior using Smack (e.g. in a <code>static {}</code> code block).</p><h2>DNSSEC API</h2><p>Smack's DNSSEC API is very simple: Just use <code>ConnectionConfiguration.Builder..setDnssecMode(DnssecMode)</code> to enable DNSSEC. <code>DnssecMode</code> can be one of</p>
<ul>
  <li><code>disabled</code></li>
  <li><code>needsDnssec</code></li>
  <li><code>needsDnssecAndDane</code></li>
</ul><p>The default is <code>disabled</code>.</p><p>If <code>needsDnssec</code> is used, then Smack will only connect if the DNS results required to determine a host for the XMPP domain could be verified using DNSSEC.</p><p>If <code>needsDnssecAndDane</code> then DANE will be used to verify the XMPP service's TLS certificate if STARTTLS is used. Note that you may want to configure <code>ConnectionConfiguration.Builder.setSecurityMode(SecurityMode.required)</code> if you use this DNSSEC mode setting.</p><h2>Best practices</h2><p>We recommend that applications using Smack's DNSSEC API do not ask the user if DNSSEC is avaialble. Instead they should check for DNSSEC suport on every connection attempt. Once DNSSEC support has been discovered, the application should use the <code>needsDnssec</code> mode for all future connection attempts. The same scheme can be applied when using DANE. This approach is similar to the scheme established by to <a href="https://tools.ietf.org/html/rfc6797">"HTTP Strict Transport Security" (HSTS, RFC 6797)</a>.</p>